import os
from tkinter import filedialog


def insert_tag_all():
    for each_variant in variant:
        whole_file = open(file).read().replace(f'{btl_line}', f'{btl_line}\n{variant_line}{each_variant}')
        output = open(file, 'w')
        output.write(whole_file)
        output.close()


def insert_tag():
    whole_file = open(file).read().replace(f'{btl_line}', f'{btl_line}\n{variant_line}{variant}')
    output = open(file, 'w')
    output.write(whole_file)
    output.close()


error_counter = 0
tc_counter = 0
btl_line = '#@BTL       2.2'
variant_line = '#@VARIANT   '

HS_line = 'HS'
HS_phase = 'TIM_HS'
LS_line = 'LS'
LS_phase = 'TIM_LS'
COM_line = 'COM'
COM_phase = 'TIM_COM'
EU_line = 'EU'
EU_phase = 'TIM_EU'
US_line = 'US'
US_phase = 'TIM_US'
BSG_line = 'P22'
BSG_phase = 'P22_BSG_RQ'
TIM_ALL_phase = 'TIM_ALL'
ALL_phase = 'ALL'

sciezka = filedialog.askdirectory()

files_in_directory = []
for root, dir, files in os.walk(sciezka):
    for pojedynczy_test in files:
        if '.tc' in pojedynczy_test and '.tcl' not in pojedynczy_test:
            files_in_directory.append(os.path.join(root, pojedynczy_test))

for file in files_in_directory:
    print(file)
    tc_counter += 1
    with open(file, 'r+') as otwarty_test:
        row = otwarty_test.readlines()
        for line in row:
            if line.startswith('#@NAME'):
                tag, name = line.split()
                project, variant, *_ = name.split('_')
            if line.startswith('#@VARIANT'):
                clear_variant = open(file).read().replace(f'{line}', '')
                output2 = open(file, 'w')
                output2.write(clear_variant)
                output2.close()
            if line.startswith('#@BTL'):
                clear_btl = open(file).read().replace(f'{line}', f'{btl_line}\n')
                output3 = open(file, 'w')
                output3.write(clear_btl)
                output3.close()
        otwarty_test.close()

    if variant == HS_line:
        variant = [EU_phase, US_phase, COM_phase, HS_phase]
        insert_tag_all()
    elif variant == LS_line:
        variant = [BSG_phase, LS_phase]
        insert_tag_all()
    elif variant == COM_line:
        variant = COM_phase
        insert_tag()
    elif variant == EU_line:
        variant = EU_phase
        insert_tag()
    elif variant == US_line:
        variant = US_phase
        insert_tag()
    elif project == BSG_line:
        variant = BSG_phase
        insert_tag()
    elif variant == 'TIM':
        variant = [EU_phase, US_phase, COM_phase, LS_phase, HS_phase, TIM_ALL_phase]
        insert_tag_all()
    elif variant == ALL_phase:
        variant = [EU_phase, US_phase, COM_phase, LS_phase, HS_phase, TIM_ALL_phase, BSG_phase, ALL_phase]
        insert_tag_all()
    else:
        print('Error - unknown variant!')
        error_counter += 1

print(f'Number of updated test cases: {tc_counter}')
print(f'Number of errors: {error_counter}')
input("Press any key to continue...")

# Prepared by PLE
# Script version: 1.0 (initial)
# Date: 6-08-2019